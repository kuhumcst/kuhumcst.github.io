{"version":3,"sources":["kuhumcst/recap/widgets/tabs.cljc"],"mappings":"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","names":["p__52515","map__52516","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply","cljs.core/hash-map","cljs.core.get","kuhumcst.recap.widgets.tabs/mk-drag-state","kvs","i","n","kuhumcst.recap.util/vec-dissoc","cljs.core._EQ_","x__4217__auto__","y__4218__auto__","cljs.core/count","p__52522","map__52523","kuhumcst.recap.widgets.tabs/mk-drop-state","kv","kuhumcst.recap.util/vec-assoc","cljs.core/meta","x__4214__auto__","y__4215__auto__","kuhumcst.recap.widgets.tabs/mk-tab-id","parent-id","kuhumcst.recap.widgets.tabs/heterostyled","backgrounds","cljs.core/cycle","cljs.core/shuffle","mk-style","m","cljs.core.assoc","cljs.core.nth","cljs.core.into","cljs.core/empty","cljs.core.map_indexed","cljs.core.vary_meta","p__52530","p__52531","map__52532","map__52533","kuhumcst.recap.widgets.tabs/tab-list","state","id","opts","kuhumcst.recap.state/assert-valid","map__52538","cljs.core/deref","length","append","cljs.core.swap_BANG_","kuhumcst.recap.dom.keyboard/roving-tabindex-handler","kuhumcst.recap.dom.drag/on-drag-enter","kuhumcst.recap.dom.drag/on-drag-over","kuhumcst.recap.dom.drag/on-drag-leave","kuhumcst.recap.dom.drag/on-drop","iter__4529__auto__","s__52542","cljs.core/LazySeq","temp__5735__auto__","cljs.core/seq","cljs.core/chunked-seq?","c__4527__auto__","size__4528__auto__","b__52544","cljs.core/chunk-buffer","i__52543","cljs.core/-nth","vec__52545","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__52541","cljs.core/chunk-rest","cljs.core/first","vec__52551","cljs.core/cons","cljs.core/rest","cljs.core.range","k","_","selected?","tab-id","delete","cljs.core/assoc","insert","select","cljs.core/hash","kuhumcst.recap.dom.focus/accept!","kuhumcst.recap.dom.drag/on-drag-start","kuhumcst.recap.dom.drag/on-drag-end","p__52556","p__52557","map__52558","map__52559","kuhumcst.recap.widgets.tabs/tab-panel","map__52564","vec__52565","v","cljs.core/not-empty","p__52574","p__52575","map__52576","map__52577","kuhumcst.recap.widgets.tabs/tabs","cljs.core/chunk-first"],"sourcesContent":["(ns kuhumcst.recap.widgets.tabs\n  \"Reagent components for creating a tabbed UI.\n\n  Shared state for tab components:\n    :kvs - key-value pairs of tab labels and bodies.\n    :i   - (optional) the index of the currently selected tab.\n\n  Various opts for tab components:\n    :id - a unique id attribute for the tab-list.\n\n  ARIA reference:\n    https://www.w3.org/TR/wai-aria-practices-1.1/#tabpanel\"\n  (:require [kuhumcst.recap.dom.focus :as focus]\n            [kuhumcst.recap.dom.drag :as drag]\n            [kuhumcst.recap.dom.keyboard :as kbd]\n            [kuhumcst.recap.state :as state]\n            [kuhumcst.recap.util :as util]))\n\n;; TODO: complete a11y\n\n(defn- mk-drag-state\n  [{:keys [kvs i] :or {i 0}} n]\n  {:kvs (util/vec-dissoc kvs n)\n   :i   (cond\n          (= n i) (min i (- (count kvs) 2))                 ; go right\n          (< n i) (dec i)                                   ; go left\n          (> n i) i)})                                      ; stay in place\n\n(defn- mk-drop-state\n  [{:keys [kvs i] :or {i 0}} n kv]\n  {:kvs (util/vec-assoc kvs n kv)\n   :i   (cond\n          (:selected? (meta kv)) n                          ; go to dropped kv\n          (= n i) (inc i)                                   ; go right\n          (< n i) (inc i)                                   ; go right\n          (> n i) (max 0 i))})                              ; stay in place\n\n(defn- mk-tab-id\n  [parent-id n]\n  (str parent-id \"-\" n))\n\n(defn heterostyled\n  \"Apply heterogeneous styling to tab `kvs`.\"\n  [kvs]\n  (let [backgrounds (cycle (shuffle [\"var(--tab-background-1)\"\n                                     \"var(--tab-background-2)\"\n                                     \"var(--tab-background-3)\"\n                                     \"var(--tab-background-4)\"\n                                     \"var(--tab-background-5)\"\n                                     \"var(--tab-background-6)\"]))\n        mk-style    (fn [m n]\n                      (assoc m :style {:background (nth backgrounds n)}))]\n    (into (empty kvs)\n          (map-indexed (fn [n kv]\n                         (vary-meta kv mk-style n))\n                       kvs))))\n\n(defn tab-list\n  \"The tabs available in the `state`.\"\n  [{:keys [kvs i] :as state}\n   {:keys [id] :as opts}]\n  (state/assert-valid state ::state/kvs+i)\n  (let [{:keys [kvs i] :or {i 0}} @state\n        length (count kvs)\n        append (fn [kv]\n                 ;; Internal drops will have no increase in tab count, so when\n                 ;; appending inside the same tab-list we must account for it.\n                 (if (= id (:id (meta kv)))\n                   (swap! state mk-drop-state (dec length) kv)\n                   (swap! state mk-drop-state length kv)))]\n    [:div.tab-list {:role          \"tablist\"\n                    :id            id\n                    :on-key-down   kbd/roving-tabindex-handler\n                    :on-drag-enter (drag/on-drag-enter)\n                    :on-drag-over  (drag/on-drag-over)\n                    :on-drag-leave (drag/on-drag-leave)\n                    :on-drop       (drag/on-drop append)}\n     (for [n (range length)\n           :let [[k _ :as kv] (nth kvs n)\n                 selected? (= n i)\n                 tab-id    (mk-tab-id id n)\n                 delete    (fn []\n                             (swap! state mk-drag-state n)\n                             (vary-meta kv assoc\n                                        :id id\n                                        :selected? selected?))\n                 insert    (fn [kv]\n                             (swap! state mk-drop-state n kv))\n                 select    (fn []\n                             (swap! state assoc :i n))]]\n       ;; Would prefer using button, but FF excludes its padding from drag area.\n       [:span.tab {:role          \"tab\"\n                   :key           (hash [kvs i n])\n                   :id            tab-id\n                   :ref           focus/accept!\n                   :style         (:style (meta kv))\n                   :aria-selected selected?\n                   :tab-index     (if selected? \"0\" \"-1\")\n                   :auto-focus    selected?\n                   :on-click      select\n                   :draggable     true\n                   :on-drag-start (drag/on-drag-start delete)\n                   :on-drag-end   (drag/on-drag-end)\n                   :on-drag-enter (drag/on-drag-enter)\n                   :on-drag-over  (drag/on-drag-over)\n                   :on-drag-leave (drag/on-drag-leave)\n                   :on-drop       (drag/on-drop insert)}\n        k])]))\n\n(defn tab-panel\n  \"The currently selected tab-panel of the `state`.\"\n  [{:keys [kvs i] :as state}\n   {:keys [id] :as opts}]\n  (state/assert-valid state ::state/kvs+i)\n  (let [{:keys [kvs i] :or {i 0}} @state\n        [_ v :as kv] (when (not-empty kvs)\n                       (nth kvs i))]\n    (when v\n      [:section.tab-panel {:role            \"tabpanel\"\n                           :aria-labelledby (mk-tab-id id i)\n                           :style           (:style (meta kv))}\n       v])))\n\n(defn tabs\n  \"Merged view of the tab-list and the tab-panel of the currently selected tab.\n  Takes `state` of the form described in the docstring of this namespace.\"\n  [{:keys [kvs i] :as state}\n   {:keys [id] :as opts}]\n  [:article.tabs\n   [tab-list state opts]\n   [tab-panel state opts]])\n"]}