{"version":3,"sources":["kuhumcst/tei_facsimile/core.cljs"],"mappings":"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","names":["kuhumcst.tei-facsimile.core/prefix","kuhumcst.tei-facsimile.core/css","rescope.style/prefix-css","kuhumcst.tei-facsimile.core/da-type","type","type->s","kuhumcst.tei-facsimile.core/list-as-ul","cuphic.core.transformer","p__41446","map__41447","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply","cljs.core/hash-map","cljs.core.get","+items","cljs.core.into","iter__4529__auto__","s__41450","cljs.core/LazySeq","temp__5735__auto__","cljs.core/seq","cljs.core/chunked-seq?","c__4527__auto__","size__4528__auto__","cljs.core/count","b__41452","cljs.core/chunk-buffer","i__41451","vec__41453","cljs.core/-nth","seq__41454","first__41455","cljs.core/first","cljs.core/next","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__41449","cljs.core/chunk-rest","vec__41456","seq__41457","first__41458","cljs.core/cons","cljs.core/rest","tag","attr","content","kuhumcst.tei-facsimile.core/ref-as-anchor","p__41459","map__41460","?ref","?type","kuhumcst.tei-facsimile.core/wrap-pbs","p__41464","map__41465","<>","bindings","map__41467","begin","end","cljs.core/meta","source","cljs.core/vec","cljs.core.concat","cljs.core.subvec","p1__41462#","cljs.core.partition_by","cljs.core._EQ_","cljs.core.partition","p1__41463#","cljs.core.map","kuhumcst.tei-facsimile.core/stages","rescope.core/shadow-wrapper","rescope.helpers/default-fn","kuhumcst.tei-facsimile.core/rewrite","p1__41469#","cljs.core/memoize","cuphic.core/rewrite","kuhumcst.tei-facsimile.core/parse","rescope.formats.xml/parse","kuhumcst.tei-facsimile.core/tei-xml","xml","rescope.core/scope","cljs.core/chunk-first"],"sourcesContent":["(ns kuhumcst.tei-facsimile.core\n  (:require [shadow.resource :as resource]\n            [cuphic.core :as cup]\n            [rescope.core :as rescope]\n            [rescope.helpers :as helpers]\n            [rescope.style :as style]\n            [rescope.formats.xml :as xml]))\n\n(def prefix\n  \"tei\")\n\n(def css\n  (style/prefix-css prefix (resource/inline \"css/tei.css\")))\n\n(defn da-type\n  [type]\n  (let [type->s {\"conference\" \"denne konference\"\n                 \"org\"        \"denne organisation\"\n                 \"pers\"       \"denne person\"\n                 \"place\"      \"dette sted\"\n                 \"publ\"       \"denne publikation\"\n                 \"receiver\"   \"denne modtager\"\n                 \"sender\"     \"denne afsender\"}]\n    (str \"Vis mere om \" (type->s type \"dette\"))))\n\n(def list-as-ul\n  (cup/transformer\n    :from '[:list +items]\n    :to (fn [{:syms [+items]}]\n          (into [:ul] (for [[tag attr & content] +items]\n                        (into [:li] content))))))\n\n(def ref-as-anchor\n  (cup/transformer\n    :from '[? {:ref  ?ref\n               :type ?type} *]\n    :to (fn [{:syms [?ref ?type]}]\n          ;; TODO: bug in attr-bindings - now need to check for attr existence\n          (when ?ref\n            [:a {:href  ?ref\n                 :title (da-type ?type)}\n             [:slot]]))))\n\n;; In order to represent pbs as slides in a carousel their boundaries must be\n;; made explicit in the HTML structure.\n(def wrap-pbs\n  (cup/transformer\n    :from '[:div * [:<> [:pb] +]]\n    :to (fn [{:syms [<>] :as bindings}]\n          (let [{:keys [begin end]} (meta <>)\n                source (:source (meta bindings))]\n            (vec (concat (subvec source 0 begin)\n                         [(into [:slides] (->> (subvec source begin end)\n                                               (partition-by #(= :pb (first %)))\n                                               (partition 2)\n                                               (map #(into [:slide] %))))]\n                         (subvec source end)))))))\n\n(def stages\n  [{:transformers [wrap-pbs]}\n   {:transformers [ref-as-anchor\n                   list-as-ul]\n    :wrapper      rescope/shadow-wrapper\n    :default      (helpers/default-fn {:prefix    prefix\n                                       :attr-kmap {:xml:lang :lang\n                                                   :xml:id   :id}})}])\n\n(def rewrite\n  (memoize #(cup/rewrite % stages)))\n\n(def parse\n  (memoize xml/parse))\n\n(defn tei-xml\n  \"Parse, postprocess, and display TEI.\"\n  [xml]\n  [rescope/scope (-> xml parse rewrite) css])\n"]}