{"version":3,"sources":["clj_diff/core.cljc"],"mappings":"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","names":["clj-diff.core/diff","a","b","clj-diff.miller/diff","clj-diff.core/merge-patch","s","edit-script","delete-symbol","cljs.core/vec","additions","deletions","cljs.core.reduce","cljs.core.assoc","index","cljs.core/first","items","cljs.core/rest","cljs.core._EQ_","cljs.core.conj","cljs.core.get","cljs.core/flatten","clj-diff.core/patch*","p1__50040#","cljs.core.filter","js/clj-diff","js/clj-diff.core","js/clj-diff.core.patch","method-table__4619__auto__","cljs.core.atom","prefer-table__4620__auto__","method-cache__4621__auto__","cached-hierarchy__4622__auto__","hierarchy__4623__auto__","fexpr__50063","cljs.core/MultiFn","cljs.core.symbol","clj-diff.core/patch","_","cljs.core.apply","cljs.core/str","var_args","G__50096","clj-diff.core/edit-distance","js/Error","clj-diff.miller/edit-distance","cljs.core/count","cljs.core/+","p1__50086#","cljs.core.map","cljs.core.drop","clj-diff.core/max-or-zero","coll","cljs.core/coll?","cljs.core/empty?","cljs.core/max","G__50140","clj-diff.core/levenshtein-distance","clj_diff.core.levenshtein_distance","p1__50119#","cljs.core/vector","cljs.core.repeat","max-index","x__4214__auto__","y__4215__auto__","v","patched","cljs.core.merge","edit-groups","p1__50122#","cljs.core.not_EQ_","p1__50123#","cljs.core.partition_by","group","p1__50125#","p1__50126#","clj-diff.core/longest-common-subseq","clj-diff.miller/longest-common-subseq"],"sourcesContent":["(ns clj-diff.core\n  \"Diff, patch and related functions for Clojure sequences.\"\n  (:require [clj-diff.miller :as miller]))\n\n(defn diff\n  \"Create the edit script for transforming sequance a into sequence b.\n  An edit script is a map with keys :+ and :- for additions and deletions.\n  Additions are represented as a sequence of vectors. The first item in each\n  vector is the index where the rest of the items in the vector are to be\n  inserted. For example [3 b c] means to insert b an c after whatever is\n  in index 3. Deletions are represented as a sequence of indexes to delete.\n\n  For example: the diff of 'abcabba' and 'cbabac' would generate the edit\n  script below.\n\n      {:+ [[2 b] [6 c]], :- [0 1 5]}\n\n  An index of -1 may appear in additions and is a special case which means to\n  add the elements at the beginning of the sequence.\"\n  [a b]\n  (miller/diff a b))\n\n(defn- merge-patch\n  [s edit-script delete-symbol]\n  (let [s (vec s)\n        additions (:+ edit-script)\n        deletions (:- edit-script)\n        s (reduce (fn [a b]\n                    (assoc a b delete-symbol))\n                  s\n                  deletions)\n        s (reduce (fn [a b]\n                    (let [index (first b)\n                          items (rest b)]\n                      (if (= index -1)\n                        (assoc a 0 (conj (vec items) (get a 0)))\n                        (assoc a index (conj items (get a index))))))\n                  s\n                  additions)]\n    (flatten s)))\n\n(defn patch*\n  [s edit-script]\n  (filter #(not (nil? %)) (merge-patch s edit-script nil)))\n\n(defmulti ^{:arglists '([s edit-script])} patch\n  \"Use the instructions in the edit script to transform the sequence s into\n  a new sequence. If the edit script was created by using diff on a and b then\n  patch will use the edit script to transform a into b.\n\n  (diff a b) -> x, (patch a x) -> b.\"\n  #?(:clj  (fn [s _] (class s))\n     :cljs (fn [s _] (when (string? s) :string))))\n\n(defmethod patch :default\n  [s edit-script]\n  (patch* s edit-script))\n\n(defmethod patch #?(:clj String :cljs :string)\n  [s edit-script]\n  (apply str (patch* s edit-script)))\n\n(defn edit-distance\n  \"Returns the edit distance between the two passed sequences. May also be\n  passed an edit script. The edit distance is the minimum number of insertions\n  and deletions required to transform one sequence into another.\"\n  ([a b]\n     (miller/edit-distance a b))\n  ([edit-script]\n     (+ (count (:- edit-script))\n        (reduce + (map #(count (drop 1 %)) (:+ edit-script))))))\n\n(defn- max-or-zero [coll]\n  (if (and (coll? coll)\n           (not (empty? coll)))\n    (apply max coll)\n    0))\n\n(defn levenshtein-distance\n  \"Returns the Levenshtein distance between two sequences. May either be passed\n  the two sequences or a diff of the two sequences.\n\n  From [Wikipedia](http://en.wikipedia.org/wiki/Levenshtein_distance):\n  The Levenshtein distance between two strings is the minimum number of edits\n  needed to transform one string into the other, with the allowable edit\n  operations being insertion, deletion and substitution of a single character.\n\n  This function works not only with strings but with any Clojure sequence.\n\n  Warning! Technically this function is estimating the Levenshtein distance\n  from a computed diff. Most of the time, it is the same as the real Levenshtein\n  distance but in same cases it may be larger. The reason for this is that\n  there may be multiple paths through an edit graph with the same edit\n  distance but with differing Levenshtein distance. A future improvement to\n  the diff algorithm whould be to find all paths and prefer the one with the\n  minimum Levenshtein distance.\"\n  ([a b]\n     (levenshtein-distance (diff a b)))\n  ([edit-script]\n     (let [additions (map #(let [index (first %)\n                                 items (rest %)]\n                             (apply vector index (repeat (count items) :a)))\n                          (:+ edit-script))\n           max-index (max (max-or-zero (map first additions))\n                          (max-or-zero (:- edit-script)))\n           v (vec (repeat max-index :e))\n           patched (merge-patch v (merge edit-script {:+ additions}) :d)\n           edit-groups (filter #(not= :e (first %))\n                               (partition-by #(if (= % :e) :e :edit)\n                                             patched))]\n       (reduce + (map (fn [group]\n                        (max (count (filter #(= % :a) group))\n                             (count (filter #(= % :d) group))))\n                      edit-groups)))))\n\n(defn longest-common-subseq [a b]\n  (miller/longest-common-subseq a b))\n"]}